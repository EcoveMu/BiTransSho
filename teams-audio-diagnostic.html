<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teams éŸ³é »è¨ºæ–·å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è»Ÿæ­£é»‘é«”', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .diagnostic-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .diagnostic-section {
            margin-bottom: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title .icon {
            margin-right: 10px;
            font-size: 20px;
        }

        .diagnostic-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .diagnostic-button:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .diagnostic-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            display: none;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            width: 0%;
            transition: width 0.3s ease;
        }

        .device-list {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        .device-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .device-item:last-child {
            border-bottom: none;
        }

        .teams-tips {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .teams-tips h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .teams-tips ul {
            list-style-type: none;
            padding-left: 0;
        }

        .teams-tips li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }

        .teams-tips li:before {
            content: "ğŸ’¡";
            position: absolute;
            left: 0;
        }

        .quick-fix {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .quick-fix h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .fix-steps {
            list-style: decimal;
            padding-left: 20px;
        }

        .fix-steps li {
            margin-bottom: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="diagnostic-container">
        <div class="header">
            <h1>ğŸ¢ Teams éŸ³é »è¨ºæ–·å·¥å…·</h1>
            <p>å°ˆé–€è§£æ±º Teams æœƒè­°ä¸­å­—å¹•ç„¡è²éŸ³çš„å•é¡Œ</p>
        </div>

        <!-- ç’°å¢ƒæª¢æ¸¬ -->
        <div class="diagnostic-section">
            <div class="section-title">
                <span class="icon">ğŸŒ</span>
                ç’°å¢ƒæª¢æ¸¬
            </div>
            <button class="diagnostic-button" id="checkEnvironment">æª¢æ¸¬ Teams ç’°å¢ƒ</button>
            <div class="result" id="environmentResult"></div>
        </div>

        <!-- æ¬Šé™æª¢æ¸¬ -->
        <div class="diagnostic-section">
            <div class="section-title">
                <span class="icon">ğŸ”</span>
                éº¥å…‹é¢¨æ¬Šé™æª¢æ¸¬
            </div>
            <button class="diagnostic-button" id="checkPermissions">æª¢æŸ¥éº¥å…‹é¢¨æ¬Šé™</button>
            <div class="result" id="permissionResult"></div>
        </div>

        <!-- è¨­å‚™æª¢æ¸¬ -->
        <div class="diagnostic-section">
            <div class="section-title">
                <span class="icon">ğŸ¤</span>
                éŸ³é »è¨­å‚™æª¢æ¸¬
            </div>
            <button class="diagnostic-button" id="checkDevices">æƒæéŸ³é »è¨­å‚™</button>
            <button class="diagnostic-button" id="testMicrophone">æ¸¬è©¦éº¥å…‹é¢¨</button>
            <div class="result" id="deviceResult"></div>
            <div class="progress-bar" id="micTestProgress" style="display: none;">
                <div class="progress-fill" id="micTestFill"></div>
            </div>
        </div>

        <!-- Teams è¡çªæª¢æ¸¬ -->
        <div class="diagnostic-section">
            <div class="section-title">
                <span class="icon">ğŸ“</span>
                Teams è¡çªæª¢æ¸¬
            </div>
            <button class="diagnostic-button" id="checkTeamsConflict">æª¢æ¸¬éŸ³é »è¡çª</button>
            <div class="result" id="conflictResult"></div>
        </div>

        <!-- ä¸€éµè¨ºæ–· -->
        <div class="diagnostic-section">
            <div class="section-title">
                <span class="icon">ğŸ”§</span>
                å®Œæ•´è¨ºæ–·
            </div>
            <button class="diagnostic-button" id="runFullDiagnostic">åŸ·è¡Œå®Œæ•´è¨ºæ–·</button>
            <div class="result" id="fullDiagnosticResult"></div>
        </div>

        <!-- Teams ä½¿ç”¨å»ºè­° -->
        <div class="teams-tips">
            <h3>ğŸ¢ Teams ç’°å¢ƒæœ€ä½³å¯¦è¸</h3>
            <ul>
                <li>åœ¨åŠ å…¥æœƒè­°å‰å…ˆå•Ÿå‹•å­—å¹•åŠŸèƒ½</li>
                <li>ä½¿ç”¨ç¨ç«‹å­—å¹•è¦–çª—é¿å…éŸ³é »è¡çª</li>
                <li>ç¢ºä¿ Teams å’Œç€è¦½å™¨éƒ½æœ‰éº¥å…‹é¢¨æ¬Šé™</li>
                <li>å®šæœŸæ›´æ–°ç€è¦½å™¨å’Œ Teams æ‡‰ç”¨</li>
                <li>é¿å…åŒæ™‚ä½¿ç”¨å¤šå€‹éŸ³é »æ‡‰ç”¨</li>
            </ul>
        </div>

        <!-- å¿«é€Ÿä¿®å¾©æ–¹æ¡ˆ -->
        <div class="quick-fix">
            <h4>ğŸš€ å¸¸è¦‹å•é¡Œå¿«é€Ÿä¿®å¾©</h4>
            <ol class="fix-steps">
                <li>é‡æ–°è¼‰å…¥é é¢ (Ctrl+F5)</li>
                <li>æª¢æŸ¥ç€è¦½å™¨åœ°å€æ¬„çš„éº¥å…‹é¢¨åœ–æ¨™</li>
                <li>ç¢ºèªéº¥å…‹é¢¨æœªè¢«å…¶ä»–æ‡‰ç”¨ä½”ç”¨</li>
                <li>å˜—è©¦é€€å‡ºä¸¦é‡æ–°åŠ å…¥ Teams æœƒè­°</li>
                <li>ä½¿ç”¨å¿«æ·éµ Ctrl+Shift+W é–‹å•Ÿç¨ç«‹å­—å¹•è¦–çª—</li>
            </ol>
        </div>
    </div>

    <script>
        class TeamsAudioDiagnostic {
            constructor() {
                this.setupEventListeners();
                this.isTeamsEnvironment = false;
                this.audioDevices = [];
                this.diagnosticResults = {};
            }

            setupEventListeners() {
                document.getElementById('checkEnvironment').addEventListener('click', () => this.checkEnvironment());
                document.getElementById('checkPermissions').addEventListener('click', () => this.checkPermissions());
                document.getElementById('checkDevices').addEventListener('click', () => this.checkDevices());
                document.getElementById('testMicrophone').addEventListener('click', () => this.testMicrophone());
                document.getElementById('checkTeamsConflict').addEventListener('click', () => this.checkTeamsConflict());
                document.getElementById('runFullDiagnostic').addEventListener('click', () => this.runFullDiagnostic());
            }

            showResult(elementId, message, type = 'info') {
                const resultElement = document.getElementById(elementId);
                resultElement.className = `result ${type}`;
                resultElement.innerHTML = message;
                resultElement.style.display = 'block';
            }

            async checkEnvironment() {
                const button = document.getElementById('checkEnvironment');
                button.disabled = true;
                button.textContent = 'æª¢æ¸¬ä¸­...';

                try {
                    // æª¢æ¸¬æ˜¯å¦åœ¨ Teams ç’°å¢ƒ
                    const url = window.location.href;
                    const userAgent = navigator.userAgent;
                    
                    this.isTeamsEnvironment = url.includes('teams.microsoft.com') || 
                                            url.includes('teams.live.com') ||
                                            document.title.includes('Teams');

                    let result = '';
                    if (this.isTeamsEnvironment) {
                        result = 'âœ… æª¢æ¸¬åˆ° Teams ç’°å¢ƒ<br>';
                        result += `ğŸ“ ç•¶å‰ URL: ${url}<br>`;
                        result += `ğŸŒ ç€è¦½å™¨: ${userAgent.includes('Chrome') ? 'Chrome' : 'Other'}<br>`;
                        
                        // æª¢æ¸¬ Teams æœƒè­°ç‹€æ…‹
                        const meetingElements = document.querySelectorAll('[data-tid*="call"], [aria-label*="æœƒè­°"], [aria-label*="é€šè©±"]');
                        if (meetingElements.length > 0) {
                            result += 'ğŸ“ æª¢æ¸¬åˆ°æ´»èºçš„ Teams æœƒè­°';
                        } else {
                            result += 'ğŸ’¤ ç›®å‰æœªåœ¨ Teams æœƒè­°ä¸­';
                        }
                        
                        this.showResult('environmentResult', result, 'success');
                    } else {
                        result = 'âš ï¸ æœªæª¢æ¸¬åˆ° Teams ç’°å¢ƒ<br>';
                        result += 'å»ºè­°åœ¨ Teams é é¢ä¸­ä½¿ç”¨æ­¤è¨ºæ–·å·¥å…·';
                        this.showResult('environmentResult', result, 'warning');
                    }

                    this.diagnosticResults.environment = this.isTeamsEnvironment;

                } catch (error) {
                    this.showResult('environmentResult', `âŒ ç’°å¢ƒæª¢æ¸¬å¤±æ•—: ${error.message}`, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'æª¢æ¸¬ Teams ç’°å¢ƒ';
                }
            }

            async checkPermissions() {
                const button = document.getElementById('checkPermissions');
                button.disabled = true;
                button.textContent = 'æª¢æŸ¥ä¸­...';

                try {
                    let result = '';

                    // æª¢æŸ¥ Permissions API æ”¯æ´
                    if (navigator.permissions) {
                        try {
                            const micPermission = await navigator.permissions.query({ name: 'microphone' });
                            result += `ğŸ” éº¥å…‹é¢¨æ¬Šé™ç‹€æ…‹: ${micPermission.state}<br>`;
                            
                            if (micPermission.state === 'granted') {
                                result += 'âœ… éº¥å…‹é¢¨æ¬Šé™å·²æˆäºˆ';
                                this.diagnosticResults.permission = 'granted';
                            } else if (micPermission.state === 'prompt') {
                                result += 'ğŸ”” éœ€è¦ç”¨æˆ¶ç¢ºèªéº¥å…‹é¢¨æ¬Šé™';
                                this.diagnosticResults.permission = 'prompt';
                            } else {
                                result += 'âŒ éº¥å…‹é¢¨æ¬Šé™è¢«æ‹’çµ•';
                                this.diagnosticResults.permission = 'denied';
                            }
                        } catch (permError) {
                            result += `âš ï¸ ç„¡æ³•æŸ¥è©¢æ¬Šé™ç‹€æ…‹: ${permError.message}<br>`;
                            result += 'å˜—è©¦ç›´æ¥æ¸¬è©¦éº¥å…‹é¢¨å­˜å–...';
                        }
                    }

                    // ç›´æ¥æ¸¬è©¦éº¥å…‹é¢¨å­˜å–
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        result += '<br>âœ… éº¥å…‹é¢¨å­˜å–æ¸¬è©¦æˆåŠŸ';
                        stream.getTracks().forEach(track => track.stop());
                        this.diagnosticResults.microphoneAccess = true;
                        this.showResult('permissionResult', result, 'success');
                    } catch (accessError) {
                        result += `<br>âŒ éº¥å…‹é¢¨å­˜å–å¤±æ•—: ${accessError.name}`;
                        if (accessError.name === 'NotAllowedError') {
                            result += '<br>ğŸ”§ è§£æ±ºæ–¹æ¡ˆ: é»æ“Šç¶²å€åˆ—çš„é–é ­åœ–æ¨™ï¼Œå…è¨±éº¥å…‹é¢¨æ¬Šé™';
                        } else if (accessError.name === 'NotFoundError') {
                            result += '<br>ğŸ”§ è§£æ±ºæ–¹æ¡ˆ: æª¢æŸ¥éº¥å…‹é¢¨è¨­å‚™æ˜¯å¦æ­£ç¢ºé€£æ¥';
                        }
                        this.diagnosticResults.microphoneAccess = false;
                        this.showResult('permissionResult', result, 'error');
                    }

                } catch (error) {
                    this.showResult('permissionResult', `âŒ æ¬Šé™æª¢æŸ¥å¤±æ•—: ${error.message}`, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'æª¢æŸ¥éº¥å…‹é¢¨æ¬Šé™';
                }
            }

            async checkDevices() {
                const button = document.getElementById('checkDevices');
                button.disabled = true;
                button.textContent = 'æƒæä¸­...';

                try {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    const audioInputs = devices.filter(device => device.kind === 'audioinput');
                    
                    this.audioDevices = audioInputs;
                    
                    let result = `ğŸ¤ æ‰¾åˆ° ${audioInputs.length} å€‹éŸ³é »è¼¸å…¥è¨­å‚™:<br>`;
                    
                    if (audioInputs.length === 0) {
                        result += 'âŒ æœªæ‰¾åˆ°ä»»ä½•éŸ³é »è¼¸å…¥è¨­å‚™';
                        this.showResult('deviceResult', result, 'error');
                    } else {
                        result += '<div class="device-list">';
                        audioInputs.forEach((device, index) => {
                            const label = device.label || `è¨­å‚™ ${index + 1}`;
                            result += `<div class="device-item">ğŸ“± ${label}</div>`;
                        });
                        result += '</div>';
                        
                        this.diagnosticResults.audioDevices = audioInputs.length;
                        this.showResult('deviceResult', result, 'success');
                    }

                } catch (error) {
                    this.showResult('deviceResult', `âŒ è¨­å‚™æƒæå¤±æ•—: ${error.message}`, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'æƒæéŸ³é »è¨­å‚™';
                }
            }

            async testMicrophone() {
                const button = document.getElementById('testMicrophone');
                const progressBar = document.getElementById('micTestProgress');
                const progressFill = document.getElementById('micTestFill');
                
                button.disabled = true;
                button.textContent = 'æ¸¬è©¦ä¸­...';
                progressBar.style.display = 'block';

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // å‰µå»ºéŸ³é »åˆ†æå™¨
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const analyser = audioContext.createAnalyser();
                    const microphone = audioContext.createMediaStreamSource(stream);
                    
                    microphone.connect(analyser);
                    analyser.fftSize = 256;
                    
                    const bufferLength = analyser.frequencyBinCount;
                    const dataArray = new Uint8Array(bufferLength);
                    
                    let maxVolume = 0;
                    let hasSignal = false;
                    let testDuration = 5000; // 5ç§’æ¸¬è©¦
                    let startTime = Date.now();
                    
                    const checkAudio = () => {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min((elapsed / testDuration) * 100, 100);
                        progressFill.style.width = progress + '%';
                        
                        if (elapsed < testDuration) {
                            analyser.getByteFrequencyData(dataArray);
                            
                            let sum = 0;
                            for (let i = 0; i < bufferLength; i++) {
                                sum += dataArray[i];
                            }
                            const average = sum / bufferLength;
                            maxVolume = Math.max(maxVolume, average);
                            
                            if (average > 10) {
                                hasSignal = true;
                            }
                            
                            requestAnimationFrame(checkAudio);
                        } else {
                            // æ¸¬è©¦å®Œæˆ
                            stream.getTracks().forEach(track => track.stop());
                            audioContext.close();
                            
                            let result = '';
                            if (hasSignal) {
                                result = `âœ… éº¥å…‹é¢¨æ¸¬è©¦æˆåŠŸ!<br>ğŸ“Š æœ€å¤§éŸ³é‡: ${maxVolume.toFixed(1)}<br>ğŸ¤ è¨­å‚™å·¥ä½œæ­£å¸¸`;
                                this.diagnosticResults.microphoneTest = 'success';
                                this.showResult('deviceResult', result, 'success');
                            } else {
                                result = `âš ï¸ æœªæª¢æ¸¬åˆ°éŸ³é »è¨Šè™Ÿ<br>ğŸ“Š æœ€å¤§éŸ³é‡: ${maxVolume.toFixed(1)}<br>ğŸ”§ è«‹æª¢æŸ¥éº¥å…‹é¢¨æ˜¯å¦éœéŸ³æˆ–éŸ³é‡å¤ªä½`;
                                this.diagnosticResults.microphoneTest = 'no_signal';
                                this.showResult('deviceResult', result, 'warning');
                            }
                            
                            progressBar.style.display = 'none';
                            button.disabled = false;
                            button.textContent = 'æ¸¬è©¦éº¥å…‹é¢¨';
                        }
                    };
                    
                    checkAudio();
                    
                } catch (error) {
                    this.showResult('deviceResult', `âŒ éº¥å…‹é¢¨æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                    progressBar.style.display = 'none';
                    button.disabled = false;
                    button.textContent = 'æ¸¬è©¦éº¥å…‹é¢¨';
                }
            }

            async checkTeamsConflict() {
                const button = document.getElementById('checkTeamsConflict');
                button.disabled = true;
                button.textContent = 'æª¢æ¸¬ä¸­...';

                try {
                    let result = '';
                    let conflictLevel = 'none';

                    // æª¢æŸ¥ Teams éŸ³é »å…ƒç´ 
                    const audioElements = document.querySelectorAll('audio, video');
                    const teamsAudioElements = document.querySelectorAll('audio[autoplay], video[autoplay]');
                    
                    result += `ğŸ”Š é é¢éŸ³é »å…ƒç´ : ${audioElements.length}<br>`;
                    result += `ğŸ“¹ Teams è‡ªå‹•æ’­æ”¾å…ƒç´ : ${teamsAudioElements.length}<br>`;

                    // æª¢æŸ¥ Teams æœƒè­°ç‹€æ…‹
                    const meetingIndicators = document.querySelectorAll('[data-tid*="call"], [aria-label*="æœƒè­°"], [aria-label*="é€šè©±"]');
                    if (meetingIndicators.length > 0) {
                        result += 'ğŸ“ æª¢æ¸¬åˆ°æ´»èºçš„ Teams æœƒè­°<br>';
                        conflictLevel = 'medium';
                    }

                    // æª¢æŸ¥éº¥å…‹é¢¨æ˜¯å¦è¢«ä½”ç”¨
                    try {
                        const testStream = await navigator.mediaDevices.getUserMedia({ 
                            audio: { sampleRate: 8000 } 
                        });
                        result += 'âœ… éº¥å…‹é¢¨å¯æ­£å¸¸å­˜å–<br>';
                        testStream.getTracks().forEach(track => track.stop());
                    } catch (testError) {
                        if (testError.name === 'NotReadableError') {
                            result += 'âš ï¸ éº¥å…‹é¢¨å¯èƒ½è¢« Teams ä½”ç”¨<br>';
                            conflictLevel = 'high';
                        } else {
                            result += `âŒ éº¥å…‹é¢¨å­˜å–ç•°å¸¸: ${testError.name}<br>`;
                            conflictLevel = 'high';
                        }
                    }

                    // æä¾›è§£æ±ºå»ºè­°
                    if (conflictLevel === 'high') {
                        result += '<br>ğŸ”§ å»ºè­°è§£æ±ºæ–¹æ¡ˆ:<br>';
                        result += 'â€¢ æš«æ™‚é€€å‡º Teams æœƒè­°<br>';
                        result += 'â€¢ é‡æ–°è¼‰å…¥é é¢<br>';
                        result += 'â€¢ ä½¿ç”¨ç¨ç«‹å­—å¹•è¦–çª—æ¨¡å¼';
                        this.showResult('conflictResult', result, 'error');
                    } else if (conflictLevel === 'medium') {
                        result += '<br>ğŸ’¡ æ³¨æ„äº‹é …:<br>';
                        result += 'â€¢ åœ¨æœƒè­°æœŸé–“å¯èƒ½æœ‰éŸ³é »è¡çª<br>';
                        result += 'â€¢ å»ºè­°åœ¨åŠ å…¥æœƒè­°å‰å•Ÿå‹•å­—å¹•';
                        this.showResult('conflictResult', result, 'warning');
                    } else {
                        result += 'âœ… æœªæª¢æ¸¬åˆ°æ˜é¡¯çš„éŸ³é »è¡çª';
                        this.showResult('conflictResult', result, 'success');
                    }

                    this.diagnosticResults.teamsConflict = conflictLevel;

                } catch (error) {
                    this.showResult('conflictResult', `âŒ è¡çªæª¢æ¸¬å¤±æ•—: ${error.message}`, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'æª¢æ¸¬éŸ³é »è¡çª';
                }
            }

            async runFullDiagnostic() {
                const button = document.getElementById('runFullDiagnostic');
                button.disabled = true;
                button.textContent = 'åŸ·è¡Œå®Œæ•´è¨ºæ–·...';

                try {
                    // ä¾æ¬¡åŸ·è¡Œæ‰€æœ‰è¨ºæ–·
                    await this.checkEnvironment();
                    await this.checkPermissions();
                    await this.checkDevices();
                    await this.checkTeamsConflict();

                    // ç”Ÿæˆç¶œåˆå ±å‘Š
                    let report = '<h4>ğŸ“‹ è¨ºæ–·å ±å‘Š</h4>';
                    
                    // ç’°å¢ƒç‹€æ³
                    if (this.diagnosticResults.environment) {
                        report += 'âœ… Teams ç’°å¢ƒæ­£å¸¸<br>';
                    } else {
                        report += 'âš ï¸ é Teams ç’°å¢ƒ<br>';
                    }

                    // æ¬Šé™ç‹€æ³
                    if (this.diagnosticResults.microphoneAccess) {
                        report += 'âœ… éº¥å…‹é¢¨æ¬Šé™æ­£å¸¸<br>';
                    } else {
                        report += 'âŒ éº¥å…‹é¢¨æ¬Šé™å•é¡Œ<br>';
                    }

                    // è¨­å‚™ç‹€æ³
                    if (this.diagnosticResults.audioDevices > 0) {
                        report += `âœ… æª¢æ¸¬åˆ° ${this.diagnosticResults.audioDevices} å€‹éŸ³é »è¨­å‚™<br>`;
                    } else {
                        report += 'âŒ æœªæª¢æ¸¬åˆ°éŸ³é »è¨­å‚™<br>';
                    }

                    // è¡çªç‹€æ³
                    const conflictLevel = this.diagnosticResults.teamsConflict;
                    if (conflictLevel === 'none') {
                        report += 'âœ… ç„¡éŸ³é »è¡çª<br>';
                    } else if (conflictLevel === 'medium') {
                        report += 'âš ï¸ æª¢æ¸¬åˆ°æ½›åœ¨è¡çª<br>';
                    } else {
                        report += 'âŒ æª¢æ¸¬åˆ°åš´é‡è¡çª<br>';
                    }

                    // ç¶œåˆå»ºè­°
                    report += '<br><h4>ğŸ¯ å»ºè­°æ“ä½œ</h4>';
                    
                    if (!this.diagnosticResults.microphoneAccess) {
                        report += '1. ğŸ” é¦–å…ˆè§£æ±ºéº¥å…‹é¢¨æ¬Šé™å•é¡Œ<br>';
                    }
                    
                    if (conflictLevel === 'high') {
                        report += '2. ğŸ”§ è§£æ±º Teams éŸ³é »è¡çª<br>';
                    }
                    
                    if (this.diagnosticResults.environment && this.diagnosticResults.microphoneAccess) {
                        report += '3. ğŸš€ å¯ä»¥å˜—è©¦å•Ÿå‹•å­—å¹•åŠŸèƒ½<br>';
                    }
                    
                    report += '4. ğŸ’¡ å¦‚ä»æœ‰å•é¡Œï¼Œä½¿ç”¨ç¨ç«‹å­—å¹•è¦–çª—æ¨¡å¼';

                    this.showResult('fullDiagnosticResult', report, 
                        this.diagnosticResults.microphoneAccess ? 'success' : 'warning');

                } catch (error) {
                    this.showResult('fullDiagnosticResult', `âŒ å®Œæ•´è¨ºæ–·å¤±æ•—: ${error.message}`, 'error');
                } finally {
                    button.disabled = false;
                    button.textContent = 'åŸ·è¡Œå®Œæ•´è¨ºæ–·';
                }
            }
        }

        // åˆå§‹åŒ–è¨ºæ–·å·¥å…·
        document.addEventListener('DOMContentLoaded', () => {
            new TeamsAudioDiagnostic();
        });
    </script>
</body>
</html>